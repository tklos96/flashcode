<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/Grid/GridParticles/GridParticlesMove/ParticlesOwned/Paramesh/Grid_sortParticles.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_06beb580571d8da4bd59dee7afe6838a.html">Grid</a></li><li class="navelem"><a class="el" href="dir_3663af0769abe994a06b6745dc09c949.html">GridParticles</a></li><li class="navelem"><a class="el" href="dir_e5618e81d4c1e156435b9ca0b8d372fd.html">GridParticlesMove</a></li><li class="navelem"><a class="el" href="dir_e2985f20afaa60a94e94be359b3f1f49.html">ParticlesOwned</a></li><li class="navelem"><a class="el" href="dir_2c01be38ac7930056dfe45f0e0cc712d.html">Paramesh</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">Grid_sortParticles.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a4c90264c3c479995958a0efeae6dd781"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_grid_particles_2_grid_particles_move_2_particles_owned_2_paramesh_2_grid__sort_particles_8_f90.html#a4c90264c3c479995958a0efeae6dd781">grid_sortparticles</a> (dataBuf, props, localCount, elementTypes, maxCount, elementsPerBlk, attrib1, attrib2)</td></tr>
<tr class="separator:a4c90264c3c479995958a0efeae6dd781"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a4c90264c3c479995958a0efeae6dd781"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c90264c3c479995958a0efeae6dd781">&#9670;&nbsp;</a></span>grid_sortparticles()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine grid_sortparticles </td>
          <td>(</td>
          <td class="paramtype">real, dimension(props,maxcount), intent(inout)&#160;</td>
          <td class="paramname"><em>dataBuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>props</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(inout)&#160;</td>
          <td class="paramname"><em>localCount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>elementTypes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>maxCount</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(maxblocks,elementtypes), intent(out)&#160;</td>
          <td class="paramname"><em>elementsPerBlk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>attrib1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in), optional&#160;</td>
          <td class="paramname"><em>attrib2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>call Grid_sortParticles(real(INOUT) :: dataBuf(:,:), integer(IN) :: props integer(INOUT) :: localCount, integer(IN) :: elementTypes, integer(IN) :: maxCount, integer(OUT) :: elementsPerBlk(:,:), integer(IN) :: attrib1, optional,integer(IN) :: attrib2)</p>
<p></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dataBuf</td><td>List of elements. It is two dimensional real array, the first dimension represents each element's properties, and second dimension is index to elements. </td></tr>
    <tr><td class="paramname">props</td><td>number of properties of each element in the dataBuf datastructure </td></tr>
    <tr><td class="paramname">localCount</td><td>While coming in it contains the current number of elements mapped to this processor. After all the data structure movement, the number of local elements might change, and the new value is put back into it. </td></tr>
    <tr><td class="paramname">elementTypes</td><td>Count of different types of elements in the simulation </td></tr>
    <tr><td class="paramname">maxCount</td><td>This is parameter determined at runtime, and is the maximum number of local elements that a simulation expects to have. All the arrays that hold particles in the Particles unit are allocated based on this number. </td></tr>
    <tr><td class="paramname">elementsPerBlk</td><td>integer array containing number of elements on each blk. </td></tr>
    <tr><td class="paramname">attrib1</td><td>the primary property of the elements on which to sort them </td></tr>
    <tr><td class="paramname">attrib2</td><td>if present, then the elements are first sorted on attrib2, and then within each group with a given attrib2 value, on the attrib1.</td></tr>
  </table>
  </dd>
</dl>
<p>NAME Grid_sortParticles</p>
<p>DESCRIPTION</p>
<p>Sorts the elements by block number. There are three types of blocknumber associated with elements data structures which have valid values, but are not valid blocknumber in the mesh. These are "UNKNOWN", "LOST" and "NONEXISTENT". The sorter finds out the number of blocks on the current processor in the mesh, and puts all elements associated with blocknumbers in the range of 1 to localNumBlocks in the processor into the appropriate bins. In the bin for localNumBlocks+1 it puts all elements with block number = UNKNOWN, and in localNumBloks+2 it put all elements with block number = LOST, in localNumBlocks+3 it puts elements with block number NONEXISTENT. For any other block number in the "gr_ptBlk" field of any element, the routine aborts.</p>
<p>NOTES Currently this routine is called (only?) by io_writeParticles in permanent guardcell mode, by Particles_advance, by Particles_updateGridVar, and by the routines that map mesh to particles or particles to mesh. CAUTION : This routine should not be called when " gr_ptSourceBuf" needs to have valid values since it is used as scratch space by this routine.</p>
<p>The algorithm used for sorting requires (and silently assumes) that o if attrib1 or attrib2 is BLK_PART_PROP then for each element is either in the valid range 1..MAXBLOCKS, or has one of the special values NONEXISTENT, UNKNOWN, LOST; and o if the attribute in particles is the particle type property for each element, it is in the valid range 1..elementTypes. Elements with a block value of UNKNOWN or LOST will be effectively dropped (by potentially reusing their storage locations for other elements, and by not counting them in the 'elementsPerBlk' output array), but this routine does <em>not</em> update the localCount counter; so the caller better take care of updating its view of the number of elements (probably from the information in 'elementsPerBlk') after Grid_sortElements returns, if some of the elements may be NONEXISTENT. Elements with a block value of NONEXISTENT will be effectively dropped (by potentially reusing their storage locations for other elements, and by not counting them in the 'elementsPerBlk' output array), but this routine does <em>not</em> update the localCount counter; so the caller better take care of updating its view of the number of elements (probably from the information in 'elementsPerBlk') after Grid_sortElements returns, if some of the elements may be NONEXISTENT.</p>
<p>DEV: This seems only correctly implemented for attrib1=BLK_PART_PROP, attrib2=TYPE_PART_PROP(or not present) </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
