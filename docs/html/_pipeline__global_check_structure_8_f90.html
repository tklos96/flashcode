<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/flashUtilities/Pipeline/Pipeline_globalCheckStructure.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_13f0565b03a429ba08dbacf88b7efdc2.html">flashUtilities</a></li><li class="navelem"><a class="el" href="dir_875206efe304ed18959d483107dfd490.html">Pipeline</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">Pipeline_globalCheckStructure.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a44d82d6a77a51e43b855f1deb10163e7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_pipeline__global_check_structure_8_f90.html#a44d82d6a77a51e43b855f1deb10163e7">pipeline_globalcheckstructure</a> ()</td></tr>
<tr class="separator:a44d82d6a77a51e43b855f1deb10163e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a44d82d6a77a51e43b855f1deb10163e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d82d6a77a51e43b855f1deb10163e7">&#9670;&nbsp;</a></span>pipeline_globalcheckstructure()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine pipeline_globalcheckstructure </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>Pipeline_globalCheckStructure ()</p>
<p></p>
<p>NAME</p>
<p>Pipeline_globalCheckStructure</p>
<p>DESCRIPTION</p>
<p>Checks the structure of the pipeline for closure. This routine is very important, as open structured pipelines will lead to possible deadlocks when unconnected channels send items, but there is no matching receiving channel at the other end.</p>
<p>Closure of a pipeline is defined by two properties: 1) each processor must have channels connecting only to other processors, not to itself and 2) all sending channels must have matching receiving channels on other processors. Point 1) is a local property and is easy to check. The second point could in principle be checked in two different ways:</p>
<p>a) Have actual non-blocking sends issued for a token item (an integer, for example) for each channel and post speculating non-blocking receives for all channels on each processor. Continuously issue non-blocking probes (mpi_iprobe calls) to check, if all token items were received properly or if there are any dangling non-blocking sends and receives waiting for completion.</p>
<p>b) Construct an actual pipeline map from the info about the channel processors given. In this case there are no actual items sent.</p>
<p>We chose to implement version b), which requires more memory (2x number of processors logicals) than a), but is sure to deliver the required info. Version a) needs less memory, but depends on the implemented mpi structure. In version a) we don't know beforehand how many calls to mpi_iprobe we need until we have message saturation (i.e. all messages that could be delivered were actually delivered).</p>
<p>Version b) is implemented the following way: On each processor define two logical vectors: a sending channel vector and a receiving channel vector. The sending channel vector is established locally on each processor and contains .true. in those places where there are connecting channels. The receiving channel vector is established non-locally using the all to all mpi command. Closure of the pipeline is achieved by having all send channel vector entries match those of the corresponding receive channel vector entries (n = processor): </p><pre class="fragment">       sendChannel (n)   |   recvChannel (n)  |  pipeline is
      -------------------|--------------------|--------------
             true        |       true         |    closed
            false        |      false         |    closed
             true        |      false         |     open
            false        |       true         |     open
</pre><p>none NOTES</p>
<p>The routine is global and acts as a barrier to all processors due to the all to all communication type. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
