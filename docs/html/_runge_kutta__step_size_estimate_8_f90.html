<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/numericalTools/RungeKutta/RungeKutta_stepSizeEstimate.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_1e5049951a47af6c299d4f194035013b.html">numericalTools</a></li><li class="navelem"><a class="el" href="dir_0b924fe236fa5e97438d96db733faef9.html">RungeKutta</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">RungeKutta_stepSizeEstimate.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a361c672613dc9d4e46fe839594409965"><td class="memItemLeft" align="right" valign="top">real function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_runge_kutta__step_size_estimate_8_f90.html#a361c672613dc9d4e46fe839594409965">rungekutta_stepsizeestimate</a> (method, f, x, y, eFrac, eBase, hmax)</td></tr>
<tr class="separator:a361c672613dc9d4e46fe839594409965"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a361c672613dc9d4e46fe839594409965"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a361c672613dc9d4e46fe839594409965">&#9670;&nbsp;</a></span>rungekutta_stepsizeestimate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function rungekutta_stepsizeestimate </td>
          <td>(</td>
          <td class="paramtype">character (len=*), intent(in)&#160;</td>
          <td class="paramname"><em>method</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (:), intent(in)&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>eFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (:), intent(in)&#160;</td>
          <td class="paramname"><em>eBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in), optional&#160;</td>
          <td class="paramname"><em>hmax</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>RungeKutta_stepSizeEstimate (character (len=*), intent (in) :: method, function, intent (in) :: f, real, intent (in) :: x, real, intent (in) :: y (:), real, intent (in) :: eFrac, real, intent (in) :: eBase (:), real, optional, intent (in) :: hmax)</p>
<p></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">method</td><td>the type of RK method for which the estimate is </td></tr>
    <tr><td class="paramname">f</td><td>the ODE function containing details of the ODE system to be solved </td></tr>
    <tr><td class="paramname">x</td><td>the initial value of the independent variable </td></tr>
    <tr><td class="paramname">y</td><td>the initial values of the dependent variable(s) </td></tr>
    <tr><td class="paramname">eFrac</td><td>the fractional value for each of the error base values </td></tr>
    <tr><td class="paramname">eBase</td><td>the error base values for each of the dependent variables </td></tr>
    <tr><td class="paramname">hmax</td><td>the safeguard maximum allowed step size (optional)</td></tr>
  </table>
  </dd>
</dl>
<p>NAME</p>
<p>RungeKutta_stepSizeEstimate</p>
<p>DESCRIPTION</p>
<p>This function provides the user with an initial estimate in step size, based on the error vector supplied and the ODE function 'f' to be solved. The estimate is based on all local information at 'x' and is obtained as follows. Consider the Taylor expansion of y (x+h) around 'x': </p><pre class="fragment">     y(x+h) = y(x) + hy'(x) + (h^2/2)y''(x) + ... + (h^m/m!)y^m(x)
</pre><p>Its truncation error can be expressed as: </p><pre class="fragment">       E(m) = h^(m+1)/(m+1)! * y^(m+1)(x*)      x* between x and x+h
</pre><p>For smooth functions we can approximate the (m+1)-th derivative at x* by the (m+1)-th derivative at x, and the error becomes: </p><pre class="fragment">       E(m) = h^(m+1)/(m+1)! * y^(m+1)(x)
</pre><p>We now transform the error based on the 'y' vector to an error based on eFrac. The reason for doing so is to be able to apply a postulate (see below) linking the the error E(m) to a postulated error E(p) for a Runge Kutta step of order p &gt;= m. We have, from the definition of the error goal for the Runge Kutta step: </p><pre class="fragment">                    y(x+h) - y(x) = eFrac * eBase
</pre><p>eFrac is a single number that, when combined with the error base vector eBase, gives an advancement error limit for each 'y' component. Hence we can rewrite the above Taylor expansion as an expansion for eFrac: </p><pre class="fragment">    eFrac = hy'(x)/eBase + h^2y''(x)/(2*eBase) + ... + h^my^m(x)/(m!*eBase)
</pre><p>and the eFrac truncation error is: </p><pre class="fragment">     E(m) = h^(m+1) * y^(m+1)(x) / ((m+1)! * eBase)
</pre><p>We next state a posutale about the behavior of E(m) when estimating a Runge Kutta step error of order p &gt;= m: </p><pre class="fragment">     E(p) = E(m)^((p+1)/(m+1))
</pre><p>This assumes a power law decrease of the error as the Runge Kutta order p increases, provided the Taylor series eFrac error E(m) is &lt; 1. If eFrac is &lt; 1 and the Taylor series is continuously converging, then E(p) &lt;= E(m).</p>
<p>As a first application of these ideas, we use m = 0 for the initial step size estimate. This means, that we use the first (linear) term in 'h' of the eFrac Taylor expansion series: </p><pre class="fragment">     eFrac = [hy'(x)/eBase]^(p+1)
</pre><p>which gives for h: </p><pre class="fragment">         h = eFrac^(1/(p+1)) * |eBase / y'(x)|
</pre><p>Note, that this last equation is actually a set of equations for each i-th component of both vectors eBase and y'(x): </p><pre class="fragment">        h(i) = eFrac^(1/(p+1)) * |eBase (i) / [y'(x)](i)|
</pre><p>and the step size estimate must be such that it leads to acceptable errors for all individual components: </p><pre class="fragment">           h = min { h(i) }
</pre><p>One problem can arise, if a particular y'(x) component is equal to zero or very small, as this would lead to a very large h(i). If some of the other h(i) are well behaved, this situation would not be a problem due to taking the minimum, however if all y'(x) are very small, the situation leads to an overly large and unacceptable step size. For this reason an (optional) maximum allowed step size estimate can be provided by the user, safeguarding against any unreasonably large step size estimate.</p>
<p>NOTES</p>
<p>Contains an interfaced function in the declarations (see below). </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
