<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/Grid/GridBoundaryConditions/Flash3HSE/gr_hseStep.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_06beb580571d8da4bd59dee7afe6838a.html">Grid</a></li><li class="navelem"><a class="el" href="dir_6ebd658f09dc477c2be5d9168dd0f546.html">GridBoundaryConditions</a></li><li class="navelem"><a class="el" href="dir_3c88645316204d30088e0d8115bd427c.html">Flash3HSE</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">gr_hseStep.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a3d66f7a24ecc0bfccb6a0021fd412b7f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gr__hse_step_8_f90.html#a3d66f7a24ecc0bfccb6a0021fd412b7f">gr_hsestep</a> (dens, temp, ye, sumy, n, inputg, delta, direction, order, mode, massFrac)</td></tr>
<tr class="separator:a3d66f7a24ecc0bfccb6a0021fd412b7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a3d66f7a24ecc0bfccb6a0021fd412b7f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d66f7a24ecc0bfccb6a0021fd412b7f">&#9670;&nbsp;</a></span>gr_hsestep()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine gr_hsestep </td>
          <td>(</td>
          <td class="paramtype">real, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>dens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(inout)&#160;</td>
          <td class="paramname"><em>temp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>ye</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in)&#160;</td>
          <td class="paramname"><em>sumy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>inputg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>order</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>mode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension(:), intent(in), optional&#160;</td>
          <td class="paramname"><em>massFrac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>call gr_hseStep(real(INOUT) :: dens(:), real(INOUT) :: temp(:), real(IN) :: ye(:), real(IN) :: sumy(:), integer(IN) :: n, real(IN) :: inputg, real(IN) :: delta, integer(IN) :: direction, integer(IN) :: order, integer(IN) :: mode, OPTIONAL,real(IN) :: massFrac(:))</p>
<p></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dens</td><td>1D array of cell densities dens(n) is used as a guess value dens(n) is set to HSE value on return </td></tr>
    <tr><td class="paramname">temp</td><td>1D array of cell temperatures temp(n) may be modified depending on mode </td></tr>
    <tr><td class="paramname">ye</td><td>1D array of cell Ye values ( number of electrons per baryon) see NOTE above </td></tr>
    <tr><td class="paramname">sumy</td><td>1D array of cell sum Y_i (number of ions per baryon) see NOTE above </td></tr>
    <tr><td class="paramname">n</td><td>index in arrays of element to be put in HSE </td></tr>
    <tr><td class="paramname">inputg</td><td>gravity (see above for sign convention) </td></tr>
    <tr><td class="paramname">delta</td><td>distance between neighboring cell centers (assumed uniform) </td></tr>
    <tr><td class="paramname">direction</td><td>determines which neighbor (above or below) to use as reference. See constants defined above </td></tr>
    <tr><td class="paramname">order</td><td>order numerical difference (1 or 2) </td></tr>
    <tr><td class="paramname">mode</td><td>determines thermodynamic constraint to use for HSE one of HSE_CONSTTEMP or HSE_CONSTENTR for an isothermal or isentropic boundary, respectively, or HSE_SETTEMP to use the temperature already set. </td></tr>
    <tr><td class="paramname">massFrac</td><td>species abundance set (applied to all cells) for when composition is species based HISTORY </td></tr>
    <tr><td class="paramname">2007</td><td>HSE BC Implementation based on Zingale/Dursi/etc.2002 Dean Townsley </td></tr>
    <tr><td class="paramname">Dec</td><td>2009 Renamed to integrate into more general code</td></tr>
  </table>
  </dd>
</dl>
<p>NAME</p>
<p>gr_hseStep</p>
<p>DESCRIPTION</p>
<p>This routine puts a cell indicated by n in hydrastatic equilibrium (HSE) with a neighboring cell (or cells if order=2) by adjusting its density and possibly temperature.</p>
<p>HSE is given by</p>
<p>d P /d x = rho * g</p>
<p>where P is the pressure, rho is the density and g is the gravity. Gravity is assumed spatially uniform and given by the argument inputg. Here for order=2 this is quantized following Zingale etal. 2002, ApJS, 143, 539 by solving their eq (42)</p>
<p>P_{+1} - P_{0} = g*delta/12 * (5 rho_{+1} + 8 rho_{0} - rho_{-1})</p>
<p>where P_{+1} = P(rho_{+1}, T_{+1}). This form is consistent with the second order reconstruction done by PPM, but is still imperfect since the resulting riemann problem is not checked to give zero flux. For order=1 (necessary for starting things out) we use</p>
<p>P_{+1} - P_{0} = g*delta * (rho_{+1} + rho_{0})/2</p>
<p>The quantities being adjusted are determined by the "mode" argument, which can be one of the following</p>
<p>HSE_CONSTTEMP The temperature of the reference neighbor cell is copied to the cell being worked on and the density is adjusted to obtain HSE. HSE_SETTEMP The temperature in the array temp(:) for the cell being worked on is assumed to have already been set and the density is adjusted to obtain HSE. HSE_CONSTENTR Both the temperature and density of the cell being worked on are adjusted so that the entropy of this cell matches that of the reference neigbor and it is in HSE. (This is a common condition for convection zones.)</p>
<p>The direction argument determines which of the cell's neigbors are used as the reference for the HSE. HSE_FORWARD cell n is placed in HSE with cell n-1 (and n-2) HSE_BACKWARD cell n is placed in HSE with cell n+1 (and n+2)</p>
<p>The directional convention for gravity </p><pre class="fragment"> |--------|
 |        |            ^
 |  n+1   |  -         |
 |        |  |         |  positive inputg
 |--------|  delta
 |        |  |
 |   n    |  -
 |        |
 |--------|
 |        |
 |  n-1   |
 |        |
</pre><p>NOTES WARNING!! some weirdness here... NOTE on composition handling (sumy, ye, and massFrac): The mode of composition handling is <em>not determined here</em>!!! If the EOS is setup to use species it will use massFrac; otherwise, if the Ye,SumY based EOS is used, they will be used.</p>
<p>If the sumy(:) and ye(:) arrays are being used, this composition information can be non-uniform. If massFrac is being used, both the reference cell(s) and the cell being put in HSE will all have the same composition.</p>
<p>TODO clean up behavior described in NOTE i.e. nominally make it so that massFrac can also be non-uniform </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
