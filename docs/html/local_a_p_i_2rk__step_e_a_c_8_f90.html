<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/numericalTools/RungeKutta/localAPI/rk_stepEAC.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_1e5049951a47af6c299d4f194035013b.html">numericalTools</a></li><li class="navelem"><a class="el" href="dir_0b924fe236fa5e97438d96db733faef9.html">RungeKutta</a></li><li class="navelem"><a class="el" href="dir_0f865233bb24d39de744b741c1e82947.html">localAPI</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">rk_stepEAC.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:aeaf661d4d8631f11e897cf4b692fc9b1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local_a_p_i_2rk__step_e_a_c_8_f90.html#aeaf661d4d8631f11e897cf4b692fc9b1">rk_stepeac</a> (f, n, nc, s, x, y, ymin, ymax, eMin, ePower, eFrac, eBase, htry, hused, hnext, yout, eout)</td></tr>
<tr class="separator:aeaf661d4d8631f11e897cf4b692fc9b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="aeaf661d4d8631f11e897cf4b692fc9b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeaf661d4d8631f11e897cf4b692fc9b1">&#9670;&nbsp;</a></span>rk_stepeac()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine rk_stepeac </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension     (:), intent(in)&#160;</td>
          <td class="paramname"><em>y</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ymin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>ymax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>eMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>ePower</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>eFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension (:), intent(in)&#160;</td>
          <td class="paramname"><em>eBase</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>htry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>hused</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(out)&#160;</td>
          <td class="paramname"><em>hnext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (:), intent(out)&#160;</td>
          <td class="paramname"><em>yout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, dimension  (:), intent(out)&#160;</td>
          <td class="paramname"><em>eout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>call rk_stepEAC (function, intent (in) :: f, integer, intent (in) :: n, integer, intent (in) :: nc, integer, intent (in) :: s, real, intent (in) :: x, real, intent (in) :: y (:), function, intent (in) :: ymin, function, intent (in) :: ymax, real, intent (in) :: eMin, real, intent (in) :: ePower, real, intent (in) :: eFrac, real, intent (in) :: eBase (:), real, intent (in) :: htry, real, intent (out) :: hused, real, intent (out) :: hnext, real, intent (out) :: yout (:), real, intent (out) :: eout (:))</p>
<p></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>the ODE function containing details of the ODE system to be solved </td></tr>
    <tr><td class="paramname">n</td><td>the number of dependent variables </td></tr>
    <tr><td class="paramname">nc</td><td>the number of confined dependent variables (nc &lt;= n, not checked here!) </td></tr>
    <tr><td class="paramname">s</td><td>the Butcher tableau size </td></tr>
    <tr><td class="paramname">x</td><td>the initial value of the independent variable </td></tr>
    <tr><td class="paramname">y</td><td>the initial values of the dependent variable(s) </td></tr>
    <tr><td class="paramname">ymin</td><td>the lower bound confinement function (as function of dependent variables) </td></tr>
    <tr><td class="paramname">ymax</td><td>the upper bound confinement function (as function of dependent variables) </td></tr>
    <tr><td class="paramname">eMin</td><td>the lowest allowed relative error (limits increase of step size) </td></tr>
    <tr><td class="paramname">ePower</td><td>the error rescaling power (equal to -1/(p+1), p = order of lowest order RK step) </td></tr>
    <tr><td class="paramname">eFrac</td><td>the fractional value for each of the error base values </td></tr>
    <tr><td class="paramname">eBase</td><td>the error base values for each of the dependent variables </td></tr>
    <tr><td class="paramname">htry</td><td>the initial step size on the independent variable </td></tr>
    <tr><td class="paramname">hused</td><td>the final step size applied on the independent variable </td></tr>
    <tr><td class="paramname">hnext</td><td>the suggested next step size on the independent variable </td></tr>
    <tr><td class="paramname">yout</td><td>the values of the dependent variable(s) after the accepted RK step </td></tr>
    <tr><td class="paramname">eout</td><td>the returned error of all dependent variable(s)</td></tr>
  </table>
  </dd>
</dl>
<p>NAME</p>
<p>rk_stepEAC</p>
<p>DESCRIPTION</p>
<p>This routine performs a single (E)mbedded (A)daptive (C)onfined Runge Kuta (RK) step. The type of embedded adaptive step performed is determined by the previously copied Butcher tableau a,b,c values. The Butcher tableau copied contains implicitly the order, its size and the kind of adapted step to be performed.</p>
<p>The details of the ODE function are contained in the passed array function 'f', which constitutes the link of the general Runge Kutta module to the individual applications. Thus 'f' has to be provided by an application outside of the Runge Kutta unit.</p>
<p>The code performs a confined RK step. The confinement boundaries are (potentially) dependent on the current value of the dependent variables at the intermediate and final RK points. This boundary dependency has to be transmitted via via 2 functions 'ymin' and 'ymax', which accept the current dependent variables array as argument input. The user has to provide the external definition of these 2 functions.</p>
<p>The code checks if at any stage during the RK step the intermediate RK points (i.e. dependent variables) are out of bounds for the confined dependent variables. If the case, the step size must be reduced (currently by a fixed factor &lt; 1, but this factor might be passed in the future as argument as well).</p>
<p>Note that the layout of the dependent variable array can always be done such that the confined variables come first. The user must therefore be careful to design its ODE function in such a way that those confined dependent variables are at the beginning of the dependent variable array.</p>
<p>NOTES</p>
<p>1) Contains interfaced functions in the declarations (see below).</p>
<p>2) The routine should be threadsave: the intermediate arrays and pointers used (rk_a, rk_b, rk_c, rk_initialFunction, rk_kVectors) have all been declared as 'threadprivate'.</p>
<p>3) For performance reasons, no local arrays are declared here. This is to avoid repeated allocation/deallocation of memory in a routine which can possibly be called many times (millions!) during an application. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
