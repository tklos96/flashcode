<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FLASH5 Test: fortran/FLASH5/source/Simulation/SimulationMain/unitTest/RungeKutta/2Dellipse/sim_distancePoint2Ellipse2Dxy.F90 File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FLASH5 Test
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_9d95adc37effe2d0447790667f945c24.html">fortran</a></li><li class="navelem"><a class="el" href="dir_aaca5e2157f58805ddf087a6c1d4d986.html">FLASH5</a></li><li class="navelem"><a class="el" href="dir_d9542af6519f0ca27bc6117ad523d5c6.html">source</a></li><li class="navelem"><a class="el" href="dir_eb3bc892adc6d650c124d9cdefebff96.html">Simulation</a></li><li class="navelem"><a class="el" href="dir_fae8d2debacb04fbbf6fc9815dd0de4d.html">SimulationMain</a></li><li class="navelem"><a class="el" href="dir_7454a16a196c8468c2c9e98e55e10a49.html">unitTest</a></li><li class="navelem"><a class="el" href="dir_63227f1858e88dfeefb2fd445105f6c7.html">RungeKutta</a></li><li class="navelem"><a class="el" href="dir_83ec0490365fa96754d84f7bff9447d0.html">2Dellipse</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">sim_distancePoint2Ellipse2Dxy.F90 File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:abf7d9bbea7308ff2a6786da015e24e82"><td class="memItemLeft" align="right" valign="top">real function, dimension(1:2)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sim__distance_point2_ellipse2_dxy_8_f90.html#abf7d9bbea7308ff2a6786da015e24e82">sim_distancepoint2ellipse2dxy</a> (a, b, Rot, Cx, Cy, Px, Py)</td></tr>
<tr class="separator:abf7d9bbea7308ff2a6786da015e24e82"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="abf7d9bbea7308ff2a6786da015e24e82"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abf7d9bbea7308ff2a6786da015e24e82">&#9670;&nbsp;</a></span>sim_distancepoint2ellipse2dxy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real function, dimension (1:2) sim_distancepoint2ellipse2dxy </td>
          <td>(</td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Rot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Cx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Cy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Px</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real, intent(in)&#160;</td>
          <td class="paramname"><em>Py</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p></p>
<p>sim_distancePoint2Ellipse2Dxy (real, intent (in) :: a, real, intent (in) :: b, real, intent (in) :: Rot, real, intent (in) :: Cx, real, intent (in) :: Cy, real, intent (in) :: Px, real, intent (in) :: Py)</p>
<p></p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>length of major semi-axis </td></tr>
    <tr><td class="paramname">b</td><td>length of minor semi-axis </td></tr>
    <tr><td class="paramname">Rot</td><td>angle (degrees) of clockwise rotation of the minor axis wrt the y-axis </td></tr>
    <tr><td class="paramname">Cx</td><td>the ellipse center x-coordinate </td></tr>
    <tr><td class="paramname">Cy</td><td>the ellipse center y-coordinate </td></tr>
    <tr><td class="paramname">Px</td><td>the x-coordinate of the point (Px,Py) </td></tr>
    <tr><td class="paramname">Py</td><td>the y-coordinate of the point (Px,Py)</td></tr>
  </table>
  </dd>
</dl>
<p>NAME</p>
<p>sim_distancePoint2Ellipse2Dxy</p>
<p>DESCRIPTION</p>
<p>Calculates the minimum/maximum distance from a point (Px,Py) to a general ellipse in 2D cartesian domain. The general ellipse is characterized by the following parameters: </p><pre class="fragment">      a   -&gt;  length of major semi-axis
      b   -&gt;  length of minor semi-axis
      Rot -&gt;  angle (degrees) of clockwise rotation of the minor axis wrt the y-axis
      Cx  -&gt;  the ellipse center x-coordinate
      Cy  -&gt;  the ellipse center y-coordinate
</pre><p>which positions the ellipse in a unique way in the 2D cartesian domain. The parametric equation of this ellipse is: </p><pre class="fragment">        | x(t) |   |   cos (Rot)  sin (Rot) |   | a sin (t) |   | Cx |
        |      | = |                        | * |           | + |    |
        | y(t) |   | - sin (Rot)  cos (Rot) |   | b cos (t) |   | Cy |
</pre><p>where 0 &lt;= t &lt;= 2pi. Derivation of the minimum distance conditions (vector from the point (Px,Py) to the ellipse curve must the perpendicular to the tangent vector at the ellipse point) leads to the following equation to be solved: </p><pre class="fragment">         R * cos (t) + S * sin (t) + U * cos (t) * sin (t) = 0
</pre><p>where: </p><pre class="fragment">         R = a  * { (Py - Cy) sin (Rot) - (Px - Cx) cos (Rot) }
         S = b  * { (Px - Cx) sin (Rot) + (Py - Cy) cos (Rot) }
         U = a^2 - b^2
</pre><p>The U term will be &gt; 0 for an ellipse and = 0 for a circle. The elliptical U term is responsible for the 'cos (t) * sin (t)' term in the above mixed trigonometric equation and makes finding the solutions in 't' hard. After 't' has been found, the distance is given by the expression: </p><pre class="fragment">      distance = sqrt { (Px - x(t))^2 + (Py - y(t))^2 }
</pre><p>There are 2 ways to solve this mixed trigonometric equation:</p>
<pre class="fragment">  1) Substitution of either sin or cos. This leads to quartic equations in terms
     of cos (t) or sin (t). For example, substituting sin (t) = sqrt (1 - cos^2 (t))
     leads to:

              cos^4 (t) + A cos^3 (t) + B cos^2 (t) + C cos(t) + D = 0

     with:

                A = 2 (S/U)
                B = (R/U)^2 + (S/U)^2 - 1
                C = - 2 (S/U)
                D = - (S/U)^2

     Drawback: Besides the need to solve a quartic, up to 8 solutions have to be
               checked: 4 solutions for cos (t) and each will lead to 2 possible
               sin (t) values via sin (t) = +/- sqrt (1 - cos^2 (t)).

     Advantage: The solution of the quartic gives all possible solutions, i.e.
                they contain both the minimum and maximum distance info. Also
                the quartic solver in FLASH is now pretty mature and very stable.


  2) Newton-Raphson (NR) iterations, starting from a suitable initial 't'. Here one
     has to be careful in choosing a good initial guess.

     Drawback: Not easy to choose an initial good guess. The mixed trigonometric
               equation can have up to 4 't' roots and since we don't know which
               of these roots will lead to the minimum or maximum distance, one
               would have to find all roots -&gt; very challenging, as each root
               cannot be factored out as for example for polynomials.

     Advantage: If the aforementioned drawbacks can be overcome and the NR can
                be made stable by choosing good initial guesses, then the four sets
                of NR iterations would probably be more economical than solving the
                quartic, although the quartic solver in FLASH is already highly
                optimized.
</pre><p>In the present code we implemented the first approach based on solving the quartic equation in cos (t). Instead of setting up the equations in the rotated framework, we use the equations of the unrotated framework, as then the minor/major axis of the ellipse coincides with the y/x axis of the domain. This procedure eliminates unnecessary multiplications by the sine and cosine of the rotation angle. The only stage at which we need to apply the rotation is at the beginning when we need to rotate BOTH the point (Px,Py) and the ellipse center (Cx,Cy) backwards to the corresponding points (Px',Py') and (Cx',Cy'). In the unrotated framework the R and S constants become: </p><pre class="fragment">                          R = - a  * (Px' - Cx')
                          S =   b  * (Py' - Cy')
</pre><p>and the unrotated ellipse parametric equation is: </p><pre class="fragment">                    | x(t) |   | a sin (t) |   | Cx' |
                    |      | = |           | + |     |
                    | y(t) |   | b cos (t) |   | Cy' |
</pre><p>NOTES</p>
<p>1) This is an array real function with two elements: </p><pre class="fragment">  sim_distancePoint2Ellipse2Dxy (1) : minimum distance
  sim_distancePoint2Ellipse2Dxy (2) : maximum distance
</pre><p>2) The code works also if each of the major/minor semiaxis a/b length is negative or zero. The following cases can be handled by the code:</p>
<p>i) |a| &gt; 0 and b = 0 (line in space of length 2|a|) ii) a = 0 and b = 0 (point in space) </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
